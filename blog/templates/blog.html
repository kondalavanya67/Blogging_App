<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



{% block blog %}
<html>
<body>

                            <h1>{{blog.heading}}</h1>
                                {{blog.content|safe}}
<h3>Upvotes :<code id="comment">  {{blog.upvotes.count}} </code><code> &nbsp&nbsp </code><a class='like-btn' data-href='{{blog.get_upvote_api_url }}' href='{{blog.get_upvote_url }}'>Upvote </a></h3>
<h3>Comments</h3>
<form action="/home/stories/{{blog.id}}" method="post" id="comment_form">
    {% csrf_token %}
    {{ form.media }}
    {{ form.as_p }}
    <input type="submit" value="Go!">
</form>
{% for comment in comments %}

        {{comment.content|safe}}
{% endfor %}


{% endblock %}
</body>
</html>

<script>
function updatetext(btn,val){
    btn.text(val)
    }

$(".like-btn").click(function(e){
  e.preventDefault()
  var this_= $(this)
  var likeUrl=this_.attr("data-href")
  $.ajax({
    url:likeUrl,
    method:"GET",
    data:{},
    success: function(data){
      console.log(data)
      $('#comment').contents()[0].nodeValue = data.upvotes;
      if(data.liked){
      updatetext(this_,"Upvoted")
    } else {
      updatetext(this_,"Upvote")
    }
    }, error: function(error){
      console.log(error)
      console.log('error')
    }
  })
})
</script>
<!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script language="JavaScript">
    $(document).ready(function() {
        $('#comment_form').submit(function() {
          console.log('dsdsds') // catch the form's submit event
            $.ajax({ // create an AJAX call...
                data: $(this).serialize(), // get the form data
                type: $(this).attr('method'), // GET or POST
                url: $(this).attr('action'), // the file to call
                success: function(response) { // on success..
                    console.log('ok')
                  }
                });
              })
            };
          ); -->
